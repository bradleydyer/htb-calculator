"use strict";var htb=angular.module("htbApp",[]);htb.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.useXDomain=!0}]),htb.controller("SliderCalculatorCtrl",["$scope",function(e){e.maxTotal=6e5,e.marginalCorrection=599500,e.interestRate=2.5,e.mortgageLenght=25,e.repayment=0,e.minRepayment=0,e.maxRepayment=0,e.deposit=3e4,e.equityLoan=0,e.principal=0,e.getDepositAsPercentage=function(){return parseFloat((100*e.deposit/(e.deposit+e.equityLoan+e.principal)).toFixed(1))},e.setEquityLoan=function(t,n){e.deposit+e.equityLoan+e.principal>e.maxTotal?e.equityLoan=40*e.maxTotal/100:e.equityLoan=parseInt(40*(t+n)/60)},e.getEquityLoanAsPercentage=function(){return parseFloat((100*e.equityLoan/(e.deposit+e.equityLoan+e.principal)).toFixed(1))},e.setPrincipal=function(){var t=parseInt(e.repayment*(1-Math.pow(1+e.calculateMonthlyInterestRate(e.interestRate),-e.calculateMortgageLenghtInMonths(e.mortgageLenght)))/e.calculateMonthlyInterestRate(e.interestRate));e.deposit+e.equityLoan+t<=e.maxTotal?e.principal=t:e.principal=e.maxTotal-e.deposit-e.equityLoan},e.findRepaymentForMaxPrincipal=function(){if(e.getDepositAsPercentage()<5)return e.maxRepayment;var t=e.maxTotal-e.deposit-e.equityLoan,n=e.calculateMonthlyInterestRate(e.interestRate),a=t,i=e.calculateMortgageLenghtInMonths(e.mortgageLenght);return parseInt(n/(1-Math.pow(1+n,-i))*a)},e.calculateMonthlyInterestRate=function(e){return e/100/12},e.calculateMortgageLenghtInMonths=function(e){return 12*e},e.getPrincipalAsPercentage=function(){return parseFloat((100*e.principal/(e.deposit+e.equityLoan+e.principal)).toFixed(1))},e.init=function(){e.calculateMinRepayment(e.interestRate,e.deposit,e.mortgageLenght),e.calculateMaxRepayment(e.interestRate,e.deposit,e.mortgageLenght),e.calculateRepayment(e.minRepayment,e.maxRepayment),e.setPrincipal()},e.calculateRepayment=function(t,n){e.repayment=parseInt((t+n)/2)},e.calculateMaxRepayment=function(t,n,a){var i=e.calculateMonthlyInterestRate(t),r=.55*e.maxTotal,o=e.calculateMortgageLenghtInMonths(a);e.maxRepayment=parseInt(i/(1-Math.pow(1+i,-o))*r)},e.calculateMinRepayment=function(t,n,a){if(n>.225*e.maxTotal)e.minRepayment=e.repayment;else{var i=e.calculateMonthlyInterestRate(t),r=.375*e.maxTotal,o=e.calculateMortgageLenghtInMonths(a);e.minRepayment=parseInt(i/(1-Math.pow(1+i,-o))*r)}},e.getTotalWithHelpToBuy=function(){return e.deposit+e.equityLoan+e.principal},e.getTotalWithoutHelpToBuy=function(){return e.deposit+e.principal},e.showInformationPanel=function(e,t){var n=jQuery(".information-container"),a=jQuery(".htb-calc");n.width(a.innerWidth()),n.height(a.height()),n.show(),jQuery(".info-panel").hide(),t.show()},e.hideInformationPanel=function(){var e=jQuery(".information-container");e.hide()},e.init(),e.$watch("deposit",function(t){e.setEquityLoan(t,e.principal),e.setPrincipal(),e.repayment=e.findRepaymentForMaxPrincipal(),e.calculateMaxRepayment(e.interestRate,t,e.mortgageLenght),e.calculateMinRepayment(e.interestRate,t,e.mortgageLenght)}),e.$watch("interestRate",function(t){e.setPrincipal(),e.setEquityLoan(e.deposit,e.principal),e.calculateMaxRepayment(t,e.deposit,e.mortgageLenght),e.calculateMinRepayment(t,e.deposit,e.mortgageLenght)}),e.$watch("mortgageLenght",function(t){e.setPrincipal(),e.setEquityLoan(e.deposit,e.principal),e.calculateMaxRepayment(e.interestRate,e.deposit,t),e.calculateMinRepayment(e.interestRate,e.deposit,t)}),e.$watch("repayment",function(t){e.setPrincipal()})}]),htb.directive("sliderCalculator",function(){return{restrict:"C",replace:!1,templateUrl:"htb/templates/slider-calculator.html",link:function(e,t,n){var a=t.find(".nouislider.mortgage-monthly-repayment")[0],i=t.find(".nouislider.mortgage-deposit")[0];noUiSlider.create(i,{animate:!1,start:e.deposit,connect:[!0,!1],step:500,range:{min:2500,max:18e4}}),i.noUiSlider.on("slide",function(){var t=parseInt(this.get());e.deposit=t,e.$apply(),a.noUiSlider.updateOptions({range:{min:e.minRepayment,max:e.maxRepayment}}),a.noUiSlider.set(e.repayment)});var r=t.find(".nouislider.mortgage-interest-rate")[0];noUiSlider.create(r,{animate:!1,start:e.interestRate,connect:[!0,!1],step:.01,range:{min:2,max:5}}),r.noUiSlider.on("slide",function(){var t=parseFloat(this.get());e.interestRate=t,e.$apply(),a.noUiSlider.updateOptions({range:{min:e.minRepayment,max:e.maxRepayment}})});var i=t.find(".nouislider.mortgage-length")[0];noUiSlider.create(i,{animate:!1,start:e.mortgageLenght,connect:[!0,!1],step:1,range:{min:25,max:35}}),i.noUiSlider.on("slide",function(){var t=parseInt(this.get());e.mortgageLenght=t,e.$apply(),a.noUiSlider.updateOptions({range:{min:e.minRepayment,max:e.maxRepayment}})});var i=t.find(".nouislider.mortgage-monthly-repayment")[0];noUiSlider.create(i,{animate:!1,start:e.repayment,connect:[!0,!1],step:1,range:{min:e.minRepayment,max:e.maxRepayment}}),i.noUiSlider.on("slide",function(){var t=parseInt(this.get());e.repayment=t,e.$apply()}),t.find(".info-bubble").bind("click",function(){var t=jQuery("."+jQuery(this).data("info-target"));e.showInformationPanel(jQuery(this),t)}),t.find(".close-panel").bind("click",function(t){e.hideInformationPanel(jQuery(this).parent()),t.preventDefault()})}}});