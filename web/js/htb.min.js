"use strict";var htb=angular.module("htbApp",[]);htb.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.useXDomain=!0}]),htb.controller("SliderCalculatorCtrl",["$scope",function(e){e.maxTotal=6e5,e.marginalCorrection=599500,e.interestRate=2.5,e.mortgageLenght=25,e.repayment=0,e.minRepayment=0,e.maxRepayment=0,e.deposit=3e4,e.equityLoan=0,e.principal=0,e.getDepositAsPercentage=function(){return parseFloat((100*e.deposit/(e.deposit+e.equityLoan+e.principal)).toFixed(1))},e.setEquityLoan=function(t,a){e.deposit+e.equityLoan+e.principal>e.maxTotal?e.equityLoan=40*e.maxTotal/100:e.equityLoan=parseInt(40*(t+a)/60)},e.getEquityLoanAsPercentage=function(){return parseFloat((100*e.equityLoan/(e.deposit+e.equityLoan+e.principal)).toFixed(1))},e.setPrincipal=function(){var t=parseInt(e.repayment*(1-Math.pow(1+e.calculateMonthlyInterestRate(e.interestRate),-e.calculateMortgageLenghtInMonths(e.mortgageLenght)))/e.calculateMonthlyInterestRate(e.interestRate));e.deposit+e.equityLoan+t<=e.maxTotal?e.principal=t:e.principal=e.maxTotal-e.deposit-e.equityLoan},e.findRepaymentForMaxPrincipal=function(){if(e.getDepositAsPercentage()<5)return e.maxRepayment;var t=e.maxTotal-e.deposit-e.equityLoan,a=e.calculateMonthlyInterestRate(e.interestRate),n=t,i=e.calculateMortgageLenghtInMonths(e.mortgageLenght);return parseInt(a/(1-Math.pow(1+a,-i))*n)},e.calculateMonthlyInterestRate=function(e){return e/100/12},e.calculateMortgageLenghtInMonths=function(e){return 12*e},e.getPrincipalAsPercentage=function(){return parseFloat((100*e.principal/(e.deposit+e.equityLoan+e.principal)).toFixed(1))},e.init=function(){e.calculateMinRepayment(e.interestRate,e.deposit,e.mortgageLenght),e.calculateMaxRepayment(e.interestRate,e.deposit,e.mortgageLenght),e.calculateRepayment(e.minRepayment,e.maxRepayment),e.setPrincipal()},e.calculateRepayment=function(t,a){e.repayment=parseInt((t+a)/2)},e.calculateMaxRepayment=function(t,a,n){var i=e.calculateMonthlyInterestRate(t),o=.55*e.maxTotal,r=e.calculateMortgageLenghtInMonths(n);e.maxRepayment=parseInt(i/(1-Math.pow(1+i,-r))*o)},e.calculateMinRepayment=function(t,a,n){if(a>.225*e.maxTotal)e.minRepayment=e.repayment;else{var i=e.calculateMonthlyInterestRate(t),o=.375*e.maxTotal,r=e.calculateMortgageLenghtInMonths(n);e.minRepayment=parseInt(i/(1-Math.pow(1+i,-r))*o)}},e.getTotalWithHelpToBuy=function(){return e.deposit+e.equityLoan+e.principal},e.getTotalWithoutHelpToBuy=function(){return e.deposit+e.principal},e.showInformationPanel=function(e,t){var a=jQuery(".information-container"),n=jQuery(".htb-calc");a.width(n.innerWidth()),a.height(n.height()),a.show(),jQuery(".info-panel").hide(),t.show()},e.hideInformationPanel=function(){var e=jQuery(".information-container");e.hide()},e.init(),e.$watch("deposit",function(t){e.setEquityLoan(t,e.principal),e.setPrincipal(),e.repayment=e.findRepaymentForMaxPrincipal(),e.calculateMaxRepayment(e.interestRate,t,e.mortgageLenght),e.calculateMinRepayment(e.interestRate,t,e.mortgageLenght)}),e.$watch("interestRate",function(t){e.setPrincipal(),e.setEquityLoan(e.deposit,e.principal),e.calculateMaxRepayment(t,e.deposit,e.mortgageLenght),e.calculateMinRepayment(t,e.deposit,e.mortgageLenght)}),e.$watch("mortgageLenght",function(t){e.setPrincipal(),e.setEquityLoan(e.deposit,e.principal),e.calculateMaxRepayment(e.interestRate,e.deposit,t),e.calculateMinRepayment(e.interestRate,e.deposit,t)}),e.$watch("repayment",function(t){e.setPrincipal()})}]),htb.directive("sliderCalculator",function(){return{restrict:"C",replace:!1,templateUrl:"htb/templates/slider-calculator.html",link:function(e,t,a){var n=t.find(".slider.mortgage-monthly-repayment");t.find(".slider.mortgage-deposit").slider({value:e.deposit,min:2500,max:18e4,step:500,slide:function(t,a){e.deposit=a.value,e.$apply(),n.slider("option","max",e.maxRepayment),n.slider("option","value",e.repayment),n.slider("option","min",e.minRepayment)}}),t.find(".slider.mortgage-interest-rate").slider({value:e.interestRate,min:2,max:5,step:.01,slide:function(t,a){e.interestRate=a.value,e.$apply(),n.slider("option","max",e.maxRepayment),n.slider("option","min",e.minRepayment)}}),t.find(".slider.mortgage-length").slider({value:e.mortgageLenght,min:25,max:35,step:1,slide:function(t,a){e.mortgageLenght=a.value,e.$apply(),n.slider("option","max",e.maxRepayment),n.slider("option","min",e.minRepayment)}}),t.find(".slider.mortgage-monthly-repayment").slider({value:e.repayment,min:e.minRepayment,max:e.maxRepayment,step:1,slide:function(t,a){e.repayment=a.value,e.$apply()}}),t.find(".info-bubble").bind("click",function(){var t=jQuery("."+jQuery(this).data("info-target"));e.showInformationPanel(jQuery(this),t)}),t.find(".close-panel").bind("click",function(t){e.hideInformationPanel(jQuery(this).parent()),t.preventDefault()})}}});